<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no" name="viewport">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no">
    <meta name="format-detection" content="email=no">
    <meta name="author" content="Cleam Lee">
	<title>video deomo</title>
	<style>
		*{margin: 0; padding: 0;}
		#J_video{width: 100%; background-color: #000;}
		.video{padding: 24px 30px 0;}
		.video video{display: block;}
	</style>
</head>
<body>

	<!-- <video id="J_video" width="320" height="240" controls="auto" poster="poster.png">
		<source src="video.mp4" type="video/mp4">
		您的浏览器不支持 video 标签。
	</video> -->

	<div class="video">
		<h3>这是一个测试视频 - 雨好大！</h3>
		<video id="J_video" controls="auto" poster="video_poster.jpg" autobuffer="true">
			<source src="test.mp4" type="video/mp4">
			您的浏览器不支持 video 标签。
		</video>
		<p class="clearfix"><em class="fl">200万次播放</em><em class="fr">中华网</em></p>
	</div>

	<p id="J_netWorkState"></p>

	<script src="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
	<script>
		var $video = $('#J_video'), duration = 0;

		/*$video.on('durationchange', function(event){
			try	{
				var video = event.target;
				duration = video.duration;
			} catch(e){
				console.log('Event durationchange has error!!!', e);
			}
		}).on('loadedmetadata', function(event){
			try	{
				var video = event.target;
				duration = video.duration;
			} catch(e){
				console.log('Event loadedmetadata has error!!!', e);
			}
		}).on('loadeddata', function(event){
			try	{
				var video = event.target;
				duration = video.duration;
			} catch(e){
				console.log('Event loadeddata has error!!!', e);
			}
		});*/

		$video.on('playing', function(event){
			console.log('playing');
			try {
				var $video = $(event.target),
					video = $video[0],
					src = video.currentSrc,
					duration = Math.floor(video.duration * 1000),
					playingTime = $video.attr('data-playingTime') ? $video.attr('data-playingTime') : 'null',
					currentTime = Math.floor(video.currentTime * 1000);	// 当前播放时间位置
				// 用于记录实际播放时长
				$video.attr('data-updateTime', +new Date());

				console.log('currentTime', currentTime);

				var param = 'qid\tuid\tosType\tbrowserType\t' + src + '\t' + duration + '\t' + playingTime + '\t' + currentTime + '\tplay';
				// console.log('param::', param);
				sendVideoLog(param);
			} catch(e){
				console.log('Event playing has error!!!', e);
			}
		});

		$video.on('pause', function(event){
			console.log('pause');
			try {
				var video = event.target;
				duration = video.duration;
			} catch(e){
				console.log('Event pause has error!!!', e);
			}
		});

		// 记录实际播放时间
		$video.on('timeupdate', function(event){
			try {
				var $video = $(event.target),
		      		updateTime = parseInt($video.attr('data-updateTime'), 10) || (+new Date()),
		      		playingTime = parseInt($video.attr('data-playingTime'), 10) || 0,
		      		now = +new Date();
	  			// 播放时间
	  			playingTime = playingTime + now - updateTime;
	  			$video.attr('data-playingTime', playingTime);
				$video.attr('data-updateTime', now);
			} catch(e){
				console.log('Event timeupdate has error!!!', e);
			}
		});

		/*// 快进中..
		$video.on('seeking', function(event){
			console.log('快进中...');
			try {
				var video = event.target;
				duration = video.duration;
			} catch(e){
				console.log('Event seeking has error!!!', e);
			}
		});

		// 已快进
		$video.on('seeked', function(event){
			console.log('已快进');
			try {
				var video = event.target;
				duration = video.duration;
			} catch(e){
				console.log('Event seeked has error!!!', e);
			}
		});*/

		

		function sendVideoLog(param){
			$.ajax({
				url: 'http://123.59.60.170/getwapdata/videoact',
				data: {
					param: param
				},
				dataType: 'jsonp',
				json: 'jsonpcallback',
				success: function(){
					// console.log('success::', arguments);
				},
				error: function(){
					// console.log('error::', arguments);
				},
			});
		}

	</script>
</body>
</html>